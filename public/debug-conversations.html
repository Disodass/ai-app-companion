<!DOCTYPE html>
<html>
<head>
    <title>Debug Conversations</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, query, where, getDocs, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const app = initializeApp({
            apiKey: "AIzaSyDueAy790_hFW6Aye2FYghRge6FOlRryFw",
            authDomain: "ai-app-companion.firebaseapp.com",
            projectId: "ai-app-companion",
            storageBucket: "ai-app-companion.firebasestorage.app",
            messagingSenderId: "506059414782",
            appId: "1:506059414782:web:70977d87fdd280f05b59af",
        });

        const db = getFirestore(app);
        const auth = getAuth(app);

        async function findConversations() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    console.log('âŒ No user signed in');
                    return;
                }
                
                console.log('ðŸ” User ID:', user.uid);
                
                // Find all conversations where user is a member
                const conversationsRef = collection(db, 'conversations');
                const q = query(
                    conversationsRef,
                    where('members', 'array-contains', user.uid),
                    orderBy('updatedAt', 'desc')
                );
                
                const snapshot = await getDocs(q);
                console.log(`ðŸ“Š Found ${snapshot.size} conversations:`);
                
                for (const doc of snapshot.docs) {
                    const data = doc.data();
                    console.log(`\nðŸ“ Conversation: ${doc.id}`);
                    console.log(`   Members: ${data.members?.join(', ')}`);
                    console.log(`   Message Count: ${data.messageCount || 0}`);
                    console.log(`   Last Updated: ${data.updatedAt?.toDate?.() || 'Unknown'}`);
                    console.log(`   Created: ${data.createdAt?.toDate?.() || 'Unknown'}`);
                    
                    // Check actual message count in subcollection
                    const messagesRef = collection(db, 'conversations', doc.id, 'messages');
                    const messagesSnapshot = await getDocs(query(messagesRef, limit(1)));
                    console.log(`   Has Messages: ${messagesSnapshot.size > 0 ? 'Yes' : 'No'}`);
                }
                
            } catch (error) {
                console.error('âŒ Error:', error);
            }
        }

        // Auto-run when page loads
        window.addEventListener('load', () => {
            setTimeout(findConversations, 1000); // Wait for auth to initialize
        });
    </script>
</head>
<body>
    <h1>Debug Conversations</h1>
    <p>Check the console for conversation details.</p>
    <p>Make sure you're signed in to the main app first.</p>
</body>
</html>
